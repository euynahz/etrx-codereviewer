# AI内容过滤功能说明

## 功能概述

为了解决AI返回结果包含冗长思考过程的问题，我们实现了智能内容提取功能，能够自动识别并过滤掉AI的思考过程，只保留核心的评审内容。

## 工作原理

### 1. 关键词识别策略
优先查找以下关键词，从这些位置开始提取内容：
- `📝 评审总结`、`评审总结`
- `🔍 发现的问题`、`发现的问题`  
- `💡 优化建议`、`优化建议`
- `## Code Review`、`## 代码评审`
- `代码评审报告`、`Review Feedback`

### 2. 思考过程过滤
自动识别并过滤以下模式的思考过程：
- `好的，我现在...`
- `我现在任务...`
- `首先，我会...`
- `让我来...`
- `我需要...`
- `接下来我...`
- `现在我来...`
- `我将对...`
- `让我分析...`
- `我来审查...`

### 3. 内容保护机制
- 保留所有Markdown标题（#、##）
- 保留列表项（-、*、1.、2.等）
- 保留代码块（```）
- 保留包含关键信息的行（问题、建议、优化、修改等）

## 配置选项

### 启用/禁用内容提取
```kotlin
val settingsService = CodeReviewerSettingsService.getInstance()
settingsService.setContentExtractionEnabled(true)  // 启用智能提取
settingsService.setContentExtractionEnabled(false) // 显示原始内容
```

### 调试模式
```kotlin
settingsService.setDebugModeEnabled(true)  // 显示提取前后对比
settingsService.setDebugModeEnabled(false) // 只显示提取后内容
```

## 使用效果

### 原始AI输出：
```
好的，我现在任务对用户提供的代码变更进行详细的代码审查，首先，我会检查代码中的潜在问题，比如代码质量、安全性、性能和最佳实践等方面。

首先看导入部分，代码中使用了 text! 和 css! 这样的加载器...

## 📝 评审总结
代码整体结构合理，但存在几个需要改进的地方。

## 🔍 发现的问题
- 使用了过时的加载器语法
- 缺少错误处理机制

## 💡 优化建议
- 升级到现代模块化方案
- 添加异常处理逻辑
```

### 提取后的输出：
```
## 📝 评审总结
代码整体结构合理，但存在几个需要改进的地方。

## 🔍 发现的问题
- 使用了过时的加载器语法
- 缺少错误处理机制

## 💡 优化建议
- 升级到现代模块化方案
- 添加异常处理逻辑
```

## 安全机制

1. **内容长度检查**：如果提取后内容过短（少于原内容的20%），自动回退到显示原始内容
2. **关键信息保护**：确保重要的技术信息不会被误过滤
3. **可配置性**：用户可以随时关闭提取功能，查看完整原始内容

## 测试建议

可以在调试模式下测试不同类型的AI输出：
1. 包含长篇思考过程的输出
2. 已经很简洁的输出
3. 格式不规范的输出
4. 纯文本无结构的输出

调试模式会显示：
- 原始内容长度
- 提取内容长度  
- 压缩比例
- 提取前后对比