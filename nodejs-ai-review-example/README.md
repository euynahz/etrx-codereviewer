# Node.js AIä»£ç è¯„å®¡ç¤ºä¾‹é¡¹ç›®

è¿™ä¸ªé¡¹ç›®æ˜¯åŸºäºETRX CodeRevieweræ’ä»¶çš„é»˜è®¤é…ç½®åˆ›å»ºçš„Node.jsç¤ºä¾‹ï¼Œå¸®åŠ©ä½ å¿«é€Ÿè°ƒè¯•AIä»£ç è¯„å®¡æç¤ºè¯ã€‚

## é¡¹ç›®ç‰¹ç‚¹

- ğŸ¤– ä½¿ç”¨ETRXæ’ä»¶çš„é»˜è®¤AIæ¨¡å‹é…ç½® (qwen3:8b)
- ğŸ“ å†…ç½®æ‰€æœ‰ETRXæ’ä»¶çš„é»˜è®¤æç¤ºæ¨¡æ¿
- ğŸš€ æä¾›å®Œæ•´çš„REST APIæ¥å£
- ğŸ”„ æ”¯æŒé‡è¯•æœºåˆ¶å’Œé”™è¯¯å¤„ç†
- ğŸ“Š è¯¦ç»†çš„æ—¥å¿—è¾“å‡ºï¼Œæ–¹ä¾¿è°ƒè¯•

## é»˜è®¤é…ç½®

```javascript
{
    modelName: "qwen3:8b",
    endpoint: "http://192.168.66.181:11434",
    apiPath: "/api/generate",
    temperature: 0.7,
    maxTokens: 2048,
    timeout: 30000,
    retryCount: 3
}
```

## å†…ç½®æç¤ºæ¨¡æ¿

1. **ç®€æ´ä»£ç è¯„å®¡** (`default`) - å¿«é€Ÿç®€æ´çš„ä»£ç è¯„å®¡ï¼Œä¸“æ³¨å…³é”®é—®é¢˜
2. **è¯¦ç»†ä»£ç è¯„å®¡** (`detailed`) - å…¨é¢åˆ†æä»£ç è´¨é‡ã€å®‰å…¨æ€§ã€æ€§èƒ½ç­‰
3. **åç«¯ä»£ç è¯„å®¡** (`backend`) - é’ˆå¯¹åç«¯ä»£ç çš„è§„èŒƒæ€§ã€åŠŸèƒ½æ€§ã€å®‰å…¨æ€§
4. **å‰ç«¯ä»£ç è¯„å®¡** (`frontend`) - é’ˆå¯¹å‰ç«¯ä»£ç çš„è´¨é‡ã€æ€§èƒ½å’Œå®‰å…¨æ€§
5. **å¼€å‘æ‰‹å†Œè¯„å®¡** (`doc`) - é’ˆå¯¹æŠ€æœ¯æ–‡æ¡£çš„å†…å®¹ã€è¡¨è¾¾å’ŒæŠ€æœ¯è§„èŒƒ

## å¿«é€Ÿå¼€å§‹

### æ–¹æ³•1: ä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰

1. åŒå‡» `start.bat` æ–‡ä»¶ï¼Œè„šæœ¬å°†è‡ªåŠ¨ï¼š
   - å®‰è£…æ‰€æœ‰ä¾èµ–
   - å¯åŠ¨WebæœåŠ¡
   - æ‰“å¼€æµè§ˆå™¨åˆ° http://localhost:3000

### æ–¹æ³•2: æ‰‹åŠ¨å¯åŠ¨

#### 1. å®‰è£…ä¾èµ–

```bash
npm install
```

#### 2. å¯åŠ¨WebæœåŠ¡

```bash
npm start
```

ç„¶ååœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ http://localhost:3000

#### 3. ä½¿ç”¨Webç•Œé¢è°ƒè¯•æç¤ºè¯

1. **é€‰æ‹©æˆ–è¾“å…¥æç¤ºè¯**ï¼š
   - ä»ä¸‹æ‹‰èœå•é€‰æ‹©é¢„è®¾æ¨¡æ¿
   - æˆ–é€‰æ‹©â€œè‡ªå®šä¹‰æ¨¡æ¿â€æ‰‹åŠ¨è¾“å…¥

2. **æµ‹è¯•AIè¿æ¥**ï¼š
   - ç‚¹å‡»â€œæµ‹è¯•è¿æ¥â€æŒ‰é’®ç¡®è®¤AIæœåŠ¡æ­£å¸¸

3. **å¼€å§‹è¯„å®¡**ï¼š
   - ç‚¹å‡»â€œå¼€å§‹è¯„å®¡ç¤ºä¾‹ä»£ç â€æŒ‰é’®
   - åœ¨å³ä¾§æŸ¥çœ‹Markdownæ ¼å¼çš„è¯„å®¡ç»“æœ

4. **å¤åˆ¶ç»“æœ**ï¼š
   - å¯ä»¥å¤åˆ¶è¯„å®¡ç»“æœæˆ–æç¤ºè¯åˆ°å‰ªè´´æ¿

#### 4. å‘½ä»¤è¡Œæµ‹è¯•

```bash
npm test
```

## Webç•Œé¢åŠŸèƒ½

### æç¤ºè¯è°ƒè¯•ç•Œé¢

- **æ¨¡æ¿é€‰æ‹©**: ä»5ä¸ªé¢„è®¾æ¨¡æ¿ä¸­é€‰æ‹©æˆ–è‡ªå®šä¹‰
- **å®æ—¶é¢„è§ˆ**: æ˜¾ç¤ºå­—ç¬¦æ•°å’Œæ¨¡æ¿éªŒè¯
- **è¿æ¥æµ‹è¯•**: ä¸€é”®æµ‹è¯•AIæœåŠ¡è¿æ¥çŠ¶æ€
- **ç¤ºä¾‹ä»£ç **: å†…ç½®ç¤ºä¾‹ä»£ç å˜æ›´ï¼Œæ–¹ä¾¿æµ‹è¯•

### ç»“æœå±•ç¤ºåŒºåŸŸ

- **Markdownæ¸²æŸ“**: æ”¯æŒå®Œæ•´çš„Markdownæ ¼å¼æ˜¾ç¤º
- **è¯¦ç»†ä¿¡æ¯**: æ˜¾ç¤ºè¯„å®¡IDã€ä½¿ç”¨æ¨¡å‹ã€è€—æ—¶ç­‰
- **å¿«æ·å¤åˆ¶**: ä¸€é”®å¤åˆ¶è¯„å®¡ç»“æœæˆ–æç¤ºè¯
- **å“åº”å¼è®¾è®¡**: é€‚é…æ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡

### é”®ç›˜å¿«æ·é”®

- `Ctrl + Enter`: å¿«é€Ÿå¼€å§‹è¯„å®¡

## APIæ¥å£è¯´æ˜

### æµ‹è¯•è¿æ¥
```http
GET /api/test-connection
```

### è·å–å¯ç”¨æ¨¡æ¿
```http
GET /api/templates
```

### ä»£ç è¯„å®¡
```http
POST /api/review
Content-Type: application/json

{
  "codeChanges": [
    {
      "fileName": "example.js",
      "oldContent": "æ—§ä»£ç å†…å®¹",
      "newContent": "æ–°ä»£ç å†…å®¹", 
      "changeType": "MODIFIED"
    }
  ],
  "template": "default"
}
```

### ä½¿ç”¨ç¤ºä¾‹ä»£ç è¯„å®¡
```http
POST /api/review-sample
Content-Type: application/json

{
  "template": "default"
}
```

## ä½¿ç”¨ç¤ºä¾‹

### 1. å‘½ä»¤è¡Œæµ‹è¯•

è¿è¡Œæµ‹è¯•è„šæœ¬æŸ¥çœ‹æ‰€æœ‰æ¨¡æ¿çš„è¯„å®¡æ•ˆæœï¼š

```bash
node test.js
```

### 2. ä½¿ç”¨curlæµ‹è¯•API

```bash
# æµ‹è¯•è¿æ¥
curl http://localhost:3000/api/test-connection

# è·å–æ¨¡æ¿åˆ—è¡¨
curl http://localhost:3000/api/templates

# ä½¿ç”¨ç¤ºä¾‹ä»£ç è¯„å®¡
curl -X POST http://localhost:3000/api/review-sample \\
  -H "Content-Type: application/json" \\
  -d '{"template": "default"}'
```

### 3. è‡ªå®šä¹‰ä»£ç è¯„å®¡

```bash
curl -X POST http://localhost:3000/api/review \\
  -H "Content-Type: application/json" \\
  -d '{
    "codeChanges": [
      {
        "fileName": "user.js",
        "oldContent": "function getUser(id) { return fetch(\"/api/user/\" + id); }",
        "newContent": "async function getUser(id) { if (!id) throw new Error(\"ID required\"); const res = await fetch(\`/api/user/\${id}\`); return res.json(); }",
        "changeType": "MODIFIED"
      }
    ],
    "template": "backend"
  }'
```

## é¡¹ç›®ç»“æ„

```
nodejs-ai-review-example/
â”œâ”€â”€ public/               # é™æ€èµ„æºæ–‡ä»¶
â”‚   â”œâ”€â”€ index.html         # Webç•Œé¢HTML
â”‚   â”œâ”€â”€ style.css          # ç•Œé¢æ ·å¼
â”‚   â””â”€â”€ script.js          # å‰ç«¯JavaScripté€»è¾‘
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ ai-reviewer.js     # AIè¯„å®¡å™¨æ ¸å¿ƒç±»
â”œâ”€â”€ index.js               # ExpressæœåŠ¡å™¨å’ŒAPIè·¯ç”±
â”œâ”€â”€ test.js                # æµ‹è¯•è„šæœ¬
â”œâ”€â”€ start.bat              # Windowså¿«é€Ÿå¯åŠ¨è„šæœ¬
â”œâ”€â”€ package.json           # é¡¹ç›®é…ç½®å’Œä¾èµ–
â””â”€â”€ README.md              # é¡¹ç›®è¯´æ˜
```

## æ ¸å¿ƒç±»è¯´æ˜

### AICodeReviewer

ä¸»è¦çš„AIä»£ç è¯„å®¡å™¨ç±»ï¼Œæä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š

- `testConnection()` - æµ‹è¯•AIæœåŠ¡è¿æ¥
- `reviewCode(codeChanges, templateKey)` - æ‰§è¡Œä»£ç è¯„å®¡
- `getAvailableTemplates()` - è·å–å¯ç”¨æ¨¡æ¿åˆ—è¡¨
- `buildCodeContent(codeChanges)` - æ„å»ºä»£ç å†…å®¹å­—ç¬¦ä¸²

## è°ƒè¯•æç¤ºè¯

1. **æŸ¥çœ‹å®Œæ•´æ—¥å¿—**: è¿è¡Œæ—¶ä¼šè¾“å‡ºè¯¦ç»†çš„è¯·æ±‚/å“åº”æ—¥å¿—
2. **ä¿®æ”¹æ¨¡æ¿**: ç›´æ¥ç¼–è¾‘ `lib/ai-reviewer.js` ä¸­çš„æ¨¡æ¿å†…å®¹
3. **è°ƒæ•´å‚æ•°**: ä¿®æ”¹æ¸©åº¦ã€æœ€å¤§tokenæ•°ç­‰å‚æ•°è§‚å¯Ÿæ•ˆæœ
4. **æµ‹è¯•ä¸åŒåœºæ™¯**: ä½¿ç”¨ä¸åŒçš„ä»£ç å˜æ›´ç±»å‹ (ADDED/MODIFIED/DELETED)

## æ•…éšœæ’é™¤

### è¿æ¥é—®é¢˜
- æ£€æŸ¥AIæœåŠ¡æ˜¯å¦å¯åŠ¨ (é»˜è®¤: http://192.168.66.181:11434)
- ç¡®è®¤æ¨¡å‹æ˜¯å¦å·²ä¸‹è½½ (qwen3:8b)
- æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œé˜²ç«å¢™è®¾ç½®

### è¯„å®¡é—®é¢˜
- æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯
- å°è¯•å‡å°‘ä»£ç å†…å®¹é•¿åº¦
- è°ƒæ•´è¶…æ—¶æ—¶é—´é…ç½®
- ä½¿ç”¨ä¸åŒçš„æç¤ºæ¨¡æ¿

## é…ç½®ä¿®æ”¹

è¦ä¿®æ”¹AIæœåŠ¡é…ç½®ï¼Œç¼–è¾‘ `index.js` æˆ– `lib/ai-reviewer.js` ä¸­çš„é…ç½®å¯¹è±¡ï¼š

```javascript
const reviewer = new AICodeReviewer({
    modelName: "your-model-name",
    endpoint: "http://your-ai-service:port",
    temperature: 0.5,
    maxTokens: 4096,
    timeout: 60000
});
```

## å¼€å‘å»ºè®®

1. å…ˆè¿è¡Œ `npm test` ç¡®è®¤åŸºæœ¬åŠŸèƒ½æ­£å¸¸
2. ä½¿ç”¨ç¤ºä¾‹ä»£ç æµ‹è¯•ä¸åŒæ¨¡æ¿çš„æ•ˆæœ
3. æ ¹æ®éœ€è¦è°ƒæ•´æç¤ºè¯å†…å®¹å’Œæ ¼å¼
4. è§‚å¯ŸAIå“åº”å†…å®¹ï¼Œä¼˜åŒ–æç¤ºè¯æŒ‡ä»¤
5. æµ‹è¯•è¾¹ç•Œæƒ…å†µï¼ˆç©ºä»£ç ã€å¤§æ–‡ä»¶ç­‰ï¼‰