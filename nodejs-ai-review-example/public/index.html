<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI代码评审调试工具</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>🤖 AI代码评审调试工具</h1>
            <p>基于ETRX CodeReviewer插件的默认配置</p>
        </header>

        <div class="main-content">
            <!-- 左侧：提示词输入区域 -->
            <div class="input-section">
                <div class="section-header">
                    <h2>📝 提示词配置</h2>
                    <div class="status-indicator">
                        <span id="connection-status" class="status-disconnected">未连接</span>
                        <button id="test-connection" class="btn-small">测试连接</button>
                    </div>
                </div>

                <!-- 模板选择器 -->
                <div class="form-group">
                    <label for="template-select">选择模板:</label>
                    <select id="template-select" class="form-control">
                        <option value="default">简洁代码评审</option>
                        <option value="detailed">详细代码评审</option>
                        <option value="backend">后端代码评审</option>
                        <option value="frontend">前端代码评审</option>
                        <option value="doc">开发手册评审</option>
                        <option value="custom">自定义模板</option>
                    </select>
                </div>

                <!-- 提示词输入框 -->
                <div class="form-group">
                    <label for="prompt-input">评审提示词:</label>
                    <textarea 
                        id="prompt-input" 
                        class="form-control prompt-textarea" 
                        placeholder="请输入或选择评审提示词模板..."
                        rows="15">
                    </textarea>
                    <div class="textarea-info">
                        <span id="char-count">0</span> 字符 | 包含 <code>{code}</code> 占位符
                    </div>
                </div>

                <!-- 操作按钮 -->
                <div class="button-group">
                    <button id="review-btn" class="btn-primary">
                        🔍 开始评审示例代码
                    </button>
                    <button id="clear-btn" class="btn-secondary">
                        🗑️ 清除结果
                    </button>
                </div>

                <!-- 示例代码预览 -->
                <div class="example-code">
                    <h3>📄 示例代码变更</h3>
                    <div class="code-preview">
                        <div class="code-file">
                            <div class="file-header">user.js (修改)</div>
                            <div class="code-diff">
                                <div class="diff-removed">- function getUser(id) { return fetch('/api/user/' + id).then(r => r.json()); }</div>
                                <div class="diff-added">+ async function getUser(id) { if (!id) throw new Error('User ID is required'); try { const response = await fetch(`/api/user/${id}`); if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`); return await response.json(); } catch (error) { console.error('Failed to fetch user:', error); throw error; } }</div>
                            </div>
                        </div>
                        <div class="code-file">
                            <div class="file-header">auth.js (新增)</div>
                            <div class="code-diff">
                                <div class="diff-added">+ const jwt = require('jsonwebtoken'); function authenticateToken(req, res, next) { ... }</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 右侧：评审结果展示区域 -->
            <div class="result-section">
                <div class="section-header">
                    <h2>📊 评审结果</h2>
                    <div class="result-info">
                        <span id="result-status" class="result-pending">等待评审</span>
                        <span id="result-time"></span>
                    </div>
                </div>

                <!-- 加载状态 -->
                <div id="loading" class="loading hidden">
                    <div class="loading-spinner"></div>
                    <p>AI正在评审代码，请稍候...</p>
                </div>

                <!-- 错误状态 -->
                <div id="error-display" class="error-display hidden">
                    <h3>❌ 评审失败</h3>
                    <p id="error-message"></p>
                </div>

                <!-- 评审结果 -->
                <div id="result-display" class="result-display hidden">
                    <div class="result-meta">
                        <div class="meta-item">
                            <span class="meta-label">评审ID:</span>
                            <span id="review-id"></span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">使用模型:</span>
                            <span id="model-used"></span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">耗时:</span>
                            <span id="review-duration"></span>
                        </div>
                    </div>
                    
                    <div class="result-content">
                        <div id="markdown-content" class="markdown-body"></div>
                    </div>

                    <!-- 复制按钮 -->
                    <div class="result-actions">
                        <button id="copy-result" class="btn-small">📋 复制结果</button>
                        <button id="copy-prompt" class="btn-small">📝 复制提示词</button>
                    </div>
                </div>

                <!-- 空状态 -->
                <div id="empty-state" class="empty-state">
                    <div class="empty-icon">🤖</div>
                    <h3>准备就绪</h3>
                    <p>选择或输入提示词，然后点击"开始评审"按钮</p>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>